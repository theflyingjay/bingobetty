<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <title>BettyBot ‚Äì Bingo</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='app.css') }}?v=5">
</head>
<body>
  <div class="stage">

    <!-- Welcome -->
    <section class="welcome active" id="view_welcome" aria-labelledby="welcomeTitle">
      <div>
        <div class="logo" id="welcomeTitle">BettyBot</div>
        <button class="start-btn" id="btn_start" aria-label="Start playing Bingo">Let's Play Bingo!</button>
        <div class="start-msg">Tap to begin ‚Ä¢ Voice & on-screen controls available</div>
      </div>
      <button class="fab-gear" id="gearBtn_welcome" aria-label="Open settings">‚öôÔ∏è</button>
    </section>

    <!-- Setup: how many games -->
    <section class="setup" id="view_setup" aria-labelledby="setupTitle">
      <div class="title" id="setupTitle">How many games will you be playing tonight?</div>
      <div class="numgrid" id="numgrid" role="group" aria-label="Choose number of games 1 to 20"></div>
      <div class="confirm" id="confirm" style="display:none;">
        <div id="confirmText" aria-live="polite"></div>
        <div class="pill" role="group" aria-label="Confirm choice">
          <button class="btn" id="btn_yes">Yes</button>
          <button class="btn" id="btn_no">No</button>
        </div>
        <div class="hint">You can say "Yes" or "No," or tap a button.</div>
      </div>
      <button class="fab-gear" id="gearBtn_setup" aria-label="Open settings">‚öôÔ∏è</button>
    </section>

    <!-- Program pick (clean list + preview modal) -->
    <section class="program-pick" id="view_program_pick" aria-labelledby="programPickTitle">
      <div class="pick-head">
        <div class="head-title" id="programPickTitle">Pick Games</div>
        <div class="head-sub" id="programPickSub">‚Äî</div>
      </div>

      <!-- Simple prompt: What type is Game N? -->
      <div class="program-prompt" id="programPrompt">What type is Game 1?</div>

      <!-- Big list of game name buttons -->
      <div class="program-list" id="programList" role="listbox" aria-label="Game types"></div>
      <!-- (No Start Session button; auto-starts when lineup is complete) -->
      <button class="fab-gear" id="gearBtn_program" aria-label="Open settings">‚öôÔ∏è</button>
    </section>

    <!-- Overview (minimal top) -->
    <section class="overview" id="view_overview" aria-labelledby="overviewTitle">
      <div class="toolbar minimal">
        <div class="grow">
          <span id="program_name" class="prog-name"></span>
          <span id="status" class="status-label" aria-live="polite">LISTENING</span>
        </div>
        <button class="btn next big" id="btn_next_game">Game Ended ‚Üí Next</button>
        <button class="fab-gear" id="gearBtn" aria-label="Open settings">‚öôÔ∏è</button>
      </div>
      <div class="cards cols-3" id="cards" aria-label="Bingo cards"></div>
    </section>

    <!-- Focus -->
    <section class="focus" id="view_focus" aria-labelledby="focusTitle">
      <div class="focus-head">
        <button class="back" id="btn_back" aria-label="Back to all cards">‚Üê Back</button>
        <div class="focus-title" id="focusTitle">Sheet ¬∑ Card 1</div>
        <div class="status">Status: <span id="status_focus" aria-live="polite">LISTENING</span></div>
      </div>
      <div class="focus-grid-wrap">
        <div class="focus-grid" id="focusGrid" aria-label="Focused bingo card"></div>
      </div>
      <button class="fab-gear" id="gearBtn_focus" aria-label="Open settings">‚öôÔ∏è</button>
    </section>

    <!-- Heard popup -->
    <div class="heard-overlay" id="heardOverlay" aria-live="polite" aria-modal="true" role="dialog">
      <div class="heard-box" role="document">
        <div class="heard-title">Heard</div>
        <div class="heard-text" id="heardText">‚Äî</div>
      </div>
    </div>
  </div>

  <!-- Drawer -->
  <div class="drawer-backdrop" id="drawerBackdrop" aria-hidden="true"></div>
  <aside class="drawer" id="drawer" aria-hidden="true" aria-label="Settings Drawer">
    <div class="controls">
      <div class="row">
        <div style="font-weight:800;">Settings</div>
        <div class="status">Status: <span id="status_drawer" aria-live="polite">LISTENING</span></div>
      </div>

      <!-- Mic Gain -->
      <div class="row gain">
        <label for="gainSlider">Mic Gain</label>
        <button class="btn" onclick="bumpGain(-0.2)" aria-label="Decrease mic gain">‚àí</button>
        <input id="gainSlider" type="range" min="0.5" max="6.0" step="0.1"
               oninput="gainLive(this.value)" onchange="gainSet(this.value)"/>
        <button class="btn" onclick="bumpGain(0.2)" aria-label="Increase mic gain">+</button>
        <span class="val" id="gainVal">3.0</span>
      </div>

      <!-- Speaker Volume -->
      <div class="row speaker">
        <label for="speakerSlider">Speaker</label>
        <button class="btn" onclick="bumpSpeaker(-5)" aria-label="Decrease speaker volume">‚àí</button>
        <input id="speakerSlider" type="range" min="0" max="100" step="1"
               oninput="speakerLive(this.value)" onchange="speakerSet(this.value)"/>
        <button class="btn" onclick="bumpSpeaker(5)" aria-label="Increase speaker volume">+</button>
        <span class="val" id="speakerVal">‚Äî</span>
      </div>

      <div class="row" role="group" aria-label="Card and call controls">
        <button class="btn" onclick="newSheet()">New Cards</button>
        <button class="btn" onclick="simulate()">Simulate Call</button>
        <button class="btn" onclick="repeatLast()">Repeat</button>
        <button class="btn" id="modeBtn_drawer" aria-pressed="false" onclick="toggleMode()">Mode: Play</button>
      </div>

      <div class="row">
        <button class="btn" id="btn_game_editor" onclick="openGameEditor()">Game Editor</button>
      </div>

      <div class="row">
        <button class="btn" onclick="closeDrawer()">Close</button>
      </div>
    </div>
  </aside>

  <!-- GAME PREVIEW MODAL -->
  <div class="modal-backdrop" id="previewBackdrop" aria-hidden="true"></div>
  <div class="modal" id="previewModal" role="dialog" aria-modal="true" aria-labelledby="previewTitle" aria-hidden="true">
    <div class="modal-card" role="document">
      <div class="modal-head">
        <div class="modal-title" id="previewTitle">Preview</div>
      </div>
      <div class="modal-body">
        <div class="preview-grid" id="previewGrid" aria-label="Animated game preview grid"></div>
        <div class="preview-desc" id="previewDesc"></div>
      </div>
      <div class="modal-actions">
        <button class="btn" id="btn_cancel_preview">Cancel</button>
        <button class="btn primary" id="btn_save_preview">Save Game Type</button>
      </div>
    </div>
  </div>

  <!-- GAME EDITOR MODAL -->
  <div class="modal-backdrop" id="gameEditorBackdrop" aria-hidden="true"></div>
  <div class="modal" id="gameEditorModal" role="dialog" aria-modal="true" aria-labelledby="gameEditorTitle" aria-hidden="true">
    <div class="modal-card game-editor-card" role="document">
      <div class="modal-head">
        <div class="modal-title" id="gameEditorTitle">Game Editor</div>
        <div class="modal-head-actions">
          <button class="btn small" id="btn_save_all_games" onclick="saveAllGames()" aria-label="Save all games to disk">üíæ Save</button>
          <button class="btn small" onclick="closeGameEditor()" aria-label="Close game editor">‚úï</button>
        </div>
      </div>
      <div class="modal-body game-editor-body">
        <div class="game-editor-tabs">
          <button class="tab-btn active" data-tab="list">Games List</button>
          <button class="tab-btn" data-tab="edit">Edit Game</button>
        </div>
        
        <!-- Games List Tab -->
        <div class="tab-content active" id="tab-list">
          <div class="game-list" id="gameList"></div>
          <button class="btn primary" id="btn_new_game" onclick="createNewGame()">New Game</button>
        </div>
        
        <!-- Edit Game Tab -->
        <div class="tab-content" id="tab-edit">
          <div class="editor-section">
            <label>Game Key (ID):</label>
            <input type="text" id="editor_key" placeholder="MY_GAME" disabled>
          </div>
          <div class="editor-section">
            <label>Game Name:</label>
            <input type="text" id="editor_name" placeholder="My Custom Game">
          </div>
          <div class="editor-section">
            <label>Description:</label>
            <textarea id="editor_desc" placeholder="Game description"></textarea>
          </div>
          
          <div class="editor-section">
            <label>Allowed Numbers (comma-separated, 1-75):</label>
            <input type="text" id="editor_allowed_numbers" placeholder="1,2,3...">
          </div>
          <div class="editor-section">
            <label>Disallowed Numbers (comma-separated, 1-75):</label>
            <input type="text" id="editor_disallowed_numbers" placeholder="1,2,3...">
          </div>
          
          <div class="editor-section">
            <label>Free Space:</label>
            <div class="toggle-group">
              <button class="btn toggle-btn" id="editor_free_enabled" onclick="toggleFreeSpace()">
                <span id="free_space_status">Enabled</span>
              </button>
            </div>
          </div>
          
          <div class="editor-section">
            <label>Winning Patterns:</label>
            <div class="patterns-preview-container">
              <div class="patterns-preview-label">Pattern Preview (Animated)</div>
              <div class="patterns-preview-grid" id="patternsPreviewGrid"></div>
            </div>
            <div id="patterns_list"></div>
            <button class="btn" onclick="addPattern()">Add Pattern</button>
          </div>
          
          <div class="editor-actions">
            <button class="btn" onclick="cancelEdit()">Cancel</button>
            <button class="btn primary" onclick="saveGame()">Save Game</button>
            <button class="btn danger" id="btn_delete_game" onclick="deleteGame()" style="display:none;">Delete</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="{{ url_for('static', filename='app.js') }}?v=5" defer></script>
</body>
</html>
